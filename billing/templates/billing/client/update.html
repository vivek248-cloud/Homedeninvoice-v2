{% extends 'billing/layouts/base.html' %}
{% block title %}Update Client | {{ client.name }}{% endblock %}
{% block page_title %}Edit Client Profile{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            <form method="POST" class="needs-validation" novalidate>
                {% csrf_token %}
                
                <div class="row g-4">
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                <h6 class="fw-bold mb-0"><i class="bi bi-person-gear me-2"></i>Personal & Contact Details</h6>
                                <span class="badge bg-primary-subtle text-primary border border-primary-subtle">ID: #{{ client.id }}</span>
                            </div>
                            <div class="card-body p-4">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label class="form-label fw-medium small">Full Name / Business Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" value="{{ client.name }}" class="form-control form-control-lg" placeholder="e.g. John Doe" required>
                                        <div class="invalid-feedback">Client name is required.</div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label fw-medium small">Primary Mobile <span class="text-danger">*</span></label>
                                        <div class="input-group has-validation">
                                            <span class="input-group-text bg-light text-muted">+91</span>
                                            <input type="text" name="mobile_1" value="{{ client.mobile_1 }}" class="form-control" placeholder="9876543210" required pattern="[0-9]{10}">
                                            <div class="invalid-feedback">Valid 10-digit primary mobile is required.</div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label fw-medium small">Secondary Mobile <span class="text-danger">*</span></label>
                                        <input type="text" name="mobile_2" value="{{ client.mobile_2 }}" class="form-control" placeholder="9876543210" required>
                                        <div class="invalid-feedback">Secondary contact is mandatory.</div>
                                    </div>

                                    <div class="col-12">
                                        <label class="form-label fw-medium small">Email Address <span class="text-danger">*</span></label>
                                        <input type="email" name="email" value="{{ client.email }}" class="form-control" placeholder="client@example.com" required>
                                        <div class="invalid-feedback">A valid email is required.</div>
                                    </div>

                                    <div class="col-12">
                                        <label class="form-label fw-medium small">Billing Address <span class="text-danger">*</span></label>
                                        <textarea name="address" class="form-control" rows="3" placeholder="Full Address..." required>{{ client.address }}</textarea>
                                        <div class="invalid-feedback">Address cannot be empty.</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3">
                                <h6 class="fw-bold mb-0"><i class="bi bi-journal-text me-2"></i>Internal Notes <span class="text-danger">*</span></h6>
                            </div>
                            <div class="card-body p-4">
                                <textarea name="notes" class="form-control" rows="4" placeholder="Enter notes here..." required>{{ client.notes }}</textarea>
                                <div class="invalid-feedback">Please provide at least a brief note about the client.</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-white py-3">
                                <h6 class="fw-bold mb-0"><i class="bi bi-currency-exchange me-2"></i>Billing Setup</h6>
                            </div>
                            <div class="card-body p-4">
                                <div class="mb-4">
                                    <label class="form-label fw-medium small">GST Number <span class="text-danger">*</span></label>
                                    <input type="text" name="gst_number" value="{{ client.gst_number }}" class="form-control text-uppercase" placeholder="GSTIN" required>
                                    <div class="invalid-feedback">GST number is required.</div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-medium small">Standard Discount (%) <span class="text-danger">*</span></label>
                                    <div class="input-group has-validation">
                                        <input type="number" step="0.01" name="discount" value="{{ client.discount }}" class="form-control" required min="0" max="100">
                                        <span class="input-group-text bg-light text-muted">%</span>
                                        <div class="invalid-feedback">Required (0-100).</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm sticky-top" style="top: 100px; z-index: 10;">
                            <div class="card-body p-4 text-center">
                                <button type="submit" class="btn btn-primary w-100 mb-2 py-2 fw-bold shadow-sm">
                                    <i class="bi bi-arrow-repeat me-1"></i> Update Profile
                                </button>
                                <a href="{% url 'client_list' %}" class="btn btn-secondary text-white w-100 text-decoration-none small">
                                    Discard Changes
                                </a>
                                <hr class="my-4">
                                <div class="alert alert-warning py-2 px-3 mb-0" style="font-size: 0.75rem;">
                                    <i class="bi bi-exclamation-triangle-fill me-1"></i> 
                                    Changes will reflect on all future invoices immediately.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

<script>
// Prevent form submission if there are invalid fields
(function () {
  'use strict'
  var forms = document.querySelectorAll('.needs-validation')
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
})()
</script>
{% endblock %}